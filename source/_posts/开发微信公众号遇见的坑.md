---
title: 开发微信公众号遇见的坑
date: 2017-1-18 22:20:11
tags: [微信,js,nodejs]
---
我的天,我的记性实在是太烂了,我以前的弄过的微信公众号都忘记的差不多了,今天想来重新弄一下,结果..

俗话说:"好记性不如烂笔头.."

不说了,直接进入正题.

这次我还是开发订阅号(准备开始弄小程序了,来回忆回忆..)    
1.肯定申请微信公众号的啦,然后正式的微信公众号在腾讯7个工作日内审批下来.如果实在没有公众号,可以申请一个测试的公众号,用于实验什么的..

2.开发的时候,在自己的电脑上写的代码,是没办法暴露在外网上的,意思就是这段代码只能在自己的局域网上跑.然后就需要一个内网暴露的软件,什么花生壳什么的都可以,但是我记得我以前用的是ngrok这个软件,这个软件是外国的. 然后我这次用的时候,发现用不了了?! 然后我google了半天,原来是升级了,[升级后的网址是这个:natapp.cn](https://natapp.cn),然后下载他的那个新的软件natapp.exe,然后按照[natapp.exe的使用教程](https://natapp.cn/article/natapp_newbie)来弄就OK了(申请账号的时候,可以用免费的套餐,但是免费的套餐有时候会自动更改那个外网的地址,所以开发的时候要经常去微信的后台去换地址,烦..).成功了.但是在开这个natapp.exe之前先,自己在自己的电脑上开一个端口80的.用什么阿帕奇服务器都行,以前我是用阿帕奇,现在get到了个,用python开web服务器,一行代码搞定..

现在贴代码..
	
	python -m SimpleHTTPServer 80  # python2
	py -3 -m http.server 80  # python3

我又发现一个,在nodejs下运行,开端口的..
先下载这个包 

	npm install http-server -g //下载这个文件包

然后就可以在站点的目录下输入

	http-server //默认开80端口 和python一样的效果.
更改端口,可以输入

	http-server -p 端口号  //可以更改任意端口,但是不要被占用了.
简单吧..(这是测试natapp有没有在运行.)

(我发现一个问题,就是用python开端口的时候,就算是在局域网里的另一台机器都访问,如果端口下的文件夹是视频什么的比较大的文件,python会自动断开这个端口.但是是网页什么的,就没问题.用nodejs开端口,可以任意使用.原因暂时不明..)

然后开完一个web服务器后就可以用natapp.exe,这个natapp的默认端口是80,所以开80端口的才有用(貌似微信的公众号的后台调试也是只支持80端口的..)

这里有个小插曲,就是关于nodejs的,我这次用的后台是nodejs,然后node有两种版本,因为历史的原因,0.几版本的(公司做的稳定版)还有一个是4.几的(个人做的,以前叫io.js,这个分支的第一个数是偶数的版本,稳定,奇数是测试版本),然后我记得我以前玩node的时候,有些库是不能在其他版本用的,然后我就想到python可以两个版本同时装在一台电脑上,node应该也是可以的吧.所以我就又跳进坑了,琢磨了好久,发现有个有个叫nvm的东西,可以管理node版本(厉害!).然后我就想玩了一下,[贴上一个大神的博客](http://dajyaretakuya.blog.51cto.com/2823475/1760255/),我想说:那个windows版的nvm好难下载,速度好慢,下载失败了好多次.. 但是最后还是被我弄下来了..    
这篇博文是关于node的npm的使用命令.其实就是说,你要使用什么版本的node就用nvm来切换过来使用npm

	nvm use 0 #切换至 0.12.7 版本 然后才调用npm安装库
	npm install -g mz-fis #安装 mz-fis 模块至全局目录，安装完成的路径是 /Users/<你的用户名>/.nvm/versions/node/v0.12.7/lib/mz-fis
	nvm use 4 #切换至 4.2.2 版本
	npm install -g react-native-cli #安装 react-native-cli 模块至全局目录，安装完成的路径是 /Users/<你的用户名>/.nvm/versions/node/v4.2.2/lib/react-native-cli

查看此电脑的node版本数和名称

	nvm ls
查看服务器中看安装的node版本

	nvm ls available
切换此电脑中的node版本
	
	nvm use 版本号

3.接入和配置公众号